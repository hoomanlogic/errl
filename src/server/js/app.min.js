var app=app||{},fragment;(function(n,t){"use strict";n.HTTP="http";n.HOST_NAME="localhost:42026";errl.config={developer:"hoomanlogic",key:"54263eb4-6ced-49bf-9bd7-14f0106c2a02",product:"ErrL",environment:null,version:"1.0.0",getState:null,getUser:function(){return"geoffrey.floyd"},onLogged:function(n){toastr.error('<p><string>Oops!<\/strong><\/p><p>We\'re really sorry about that.<\/p><p>We\'ll get this fixed as soon as possible.<\/p><a class="btn btn-default btn-link" target="_blank" href="'+errl.getErrorDetailUrl(n.errorId)+'">Show me details<\/a> ')}};n.setAccessToken=function(n){sessionStorage.setItem("accessToken",n)};n.getAccessToken=function(){return sessionStorage.getItem("accessToken")};n.hideCriteria=function(){t("#criteria").removeClass("expanded");t("#view").removeClass("with-criteria")};n.showCriteria=function(){t("#criteria").addClass("expanded");t("#view").addClass("with-criteria")}})(app,$);window.onerror=function(){errl.log(arguments)};app.getAccessToken()||(fragment=hl.common.getFragment(),fragment.access_token?(window.location.hash=fragment.state||"",app.setAccessToken(fragment.access_token)):window.location="/Account/Authorize?client_id=web&response_type=token&state="+encodeURIComponent(window.location.hash));window.onmousemove=function(n){n.y>50&&n.x<20&&!$("#criteria").hasClass("expanded")?app.showCriteria():n.y>50&&n.x>420&&$("#criteria").hasClass("expanded")&&app.hideCriteria()};var ContentEditable=React.createClass({displayName:"ContentEditable",render:function(){return React.createElement("div",{style:{display:"inline"},onInput:this.emitChange,onBlur:this.emitChange,contentEditable:!0,dangerouslySetInnerHTML:{__html:this.props.html}})},shouldComponentUpdate:function(n){return n.html!==this.props.html},emitChange:function(){var n=this.getDOMNode().innerHTML;if(this.props.onChange&&n!==this.lastHtml)this.props.onChange({target:{value:n}});this.lastHtml=n}}),DataTable=React.createClass({displayName:"DataTable",getInitialState:function(){return{sortBy:this.props.sortBy||this.props.columnDefinitions[0].field,sortAsc:!0}},componentDidUpdate:function(){$('[data-toggle="tooltip"]').tooltip()},render:function(){var h=this.state.sortBy,c=this.state.sortAsc,t=this.props.columnDefinitions,r=_.sortBy(this.props.data,function(n){return n[h]}),f,e,n,i,l,o,s,u,a,v;if(c||r.reverse(),!t)return null;for(f=[],e=[],n=0;n<t.length;n++)l=React.createElement("th",{className:"text-"+(t[n].justify||"left")},React.createElement("a",{href:"javascript:;",onClick:this.sort.bind(null,t[n].field)},t[n].display," ",React.createElement("i",{className:h===t[n].field?c?"fa fa-sort-asc":"fa fa-sort-desc":""}))),f.push(l);if(r)for(i=0;i<r.length;i++){for(o=[],n=0;n<t.length;n++)s=null,u=r[i][t[n].field],t[n].limitLength&&u.length>t[n].limitLength&&(u=u.slice(0,t[n].limitLength)),s=t[n].onRender?t[n].onRender(r[i],t[n].field,i):t[n].onCellClick?React.createElement("a",{href:"javascript:;",onClick:t[n].onCellClick.bind(null,t[n].field,r[i])},React.createElement("span",{"data-toggle":"tooltip","data-placement":"bottom",title:r[i][t[n].field]},u)):React.createElement("span",{"data-toggle":"tooltip","data-placement":"bottom",title:r[i][t[n].field]},u),a=React.createElement("td",{className:"text-"+(t[n].justify||"left")},s),o.push(a);v=React.createElement("tr",null,o);e.push(v)}return React.createElement("table",{className:"table table-striped"},React.createElement("thead",null,React.createElement("tr",null,f)),React.createElement("tbody",null,e))},sort:function(n){var i=this.state.sortBy,t=this.state.sortAsc;n===i?t=!t:(i=n,t=!0);this.setState({sortBy:i,sortAsc:t})}}),DropdownMenu=React.createClass({displayName:"DropdownMenu",getDefaultProps:function(){return{className:"",style:null,buttonContent:null,menuItems:[],open:!1}},render:function(){var n=this.props.className,t=this.props.buttonContent,i=this.props.style,r=this.props.menuItems;return n.length>0&&(n=" "+n),React.createElement("li",{ref:"dropdown",className:"dropdown"+n,onClick:this.toggle},React.createElement("a",{href:"#","data-toggle":"dropdown",className:"dropdown-toggle",style:i},t),React.createElement("ul",{className:"dropdown-menu"},r))},toggle:function(){var t=$(window),n=$(this.refs.dropdown.getDOMNode()),i=function(r){n.has(r.target).length!=0||n.is(r.target)||(n.removeClass("open"),t.off("click.Bst",i))};n.toggleClass("open");t.on("click.Bst",i)}}),Modal=React.createClass({displayName:"Modal",getDefaultProps:function(){return{backdrop:!0,buttons:[],keyboard:!0,show:!0,remote:""}},render:function(){var n=this.props.buttons.map(function(n,t){return React.createElement("button",{key:t,type:"button",className:"btn btn-"+n.type,onClick:n.handler},n.text)});return React.createElement("div",{className:"modal fade"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},this.renderCloseButton(),React.createElement("strong",null,this.props.header)),React.createElement("div",{className:"modal-body scroll"},this.props.children),React.createElement("div",{className:"modal-footer"},n))))},renderCloseButton:function(){return React.createElement("button",{type:"button",className:"close",onClick:this.hide,dangerouslySetInnerHTML:{__html:"&times"}})},hide:function(){var n=$(this.getDOMNode());n.removeClass("in");window.setTimeout(function(){n.css("display","none")},150)},show:function(){var n=$(this.getDOMNode());n.css("display","block");window.setTimeout(function(){n.addClass("in")},1)}}),Panel=React.createClass({displayName:"Panel",getDefaultProps:function(){return{header:null,type:"default"}},componentDidMount:function(){this.rememberHeight()},componentDidUpdate:function(){this.rememberHeight()},render:function(){var n=this.props.children,t=this.props.type,i=this.props.header;return React.createElement("div",{className:"panel panel-"+t},React.createElement("div",{className:"panel-heading clickable",onClick:this.toggle},React.createElement("h4",{className:"panel-title overflow"},i)),React.createElement("div",{ref:"collapsible",className:"panel-collapse collapse"},n))},rememberHeight:function(){var n=$(this.refs.collapsible.getDOMNode());this.props.height=n.height()},toggle:function(){var n=$(this.refs.collapsible.getDOMNode());n.hasClass("collapsing")||(n.hasClass("in")?(n.css("height",this.props.height+"px").removeClass("collapse in").addClass("collapsing").attr("aria-expanded",!1).height(0).css("height","0"),window.setTimeout(function(){n.removeClass("collapsing").addClass("collapse")},350)):(n.css("height","0").removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).height(0).css("height",this.props.height+"px"),window.setTimeout(function(){n.removeClass("collapsing").addClass("collapse in").height("").css("height",null)},350)))}}),ErrorHistoryModal=React.createClass({displayName:"ErrorHistoryModal",getInitialState:function(){return{details:null,info:null}},render:function(){var n=null;return this.state.info&&(n=this.state.info.map(function(n){return React.createElement("li",null,n)})),React.createElement(Modal,{ref:"modal",show:!1,header:"Error History"},React.createElement("div",null,React.createElement("ul",{id:"modalStatsInfo"},n),React.createElement(DataTable,{sortBy:"occurred",sortAsc:!1,data:this.state.details,columnDefinitions:[{field:"errorType",display:"Type"},{field:"errorDescription",display:"Description"},{field:"objectName",display:"Object"},{field:"subName",display:"Sub"},{field:"stackTrace",display:"Stack Trace",onRender:this.renderStackTrace},{field:"state",display:"State",onRender:this.renderJsonTree},{field:"details",display:"Details",onRender:this.renderJsonTree},{field:"userId",display:"User"},{field:"occurred",display:"Occurred",justify:"right"}]})))},renderStackTrace:function(n){var t=/\((.*?):(\d+):(\d+)\)/;return n.stackTrace.split(" at ").slice(1).map(function(n){var i,r;return console.log(n),i=t.exec(n),i!=null?(r=n.replace(i[0],"").trim(),React.createElement("div",null,React.createElement("a",{target:"_blank",href:i[1]},React.createElement("span",{"data-toggle":"tooltip","data-placement":"right",title:i[0]},r)))):React.createElement("div",null,n)})},renderJsonTree:function(n,t){return n[t].split(",").map(function(n){return React.createElement("div",null,n)})},handleClose:function(){this.refs.modal.hide()},open:function(n){this.setState({details:n.details,info:n.info});this.refs.modal.show()}}),StatusPage=React.createClass({displayName:"StatusPage",getInitialState:function(){return{options:null,criteria_product:null,criteria_environment:null,criteria_version:null,criteria_from:null,criteria_to:null,fromOptions:[],toOptions:[],hourlySummaryResult:null,errorSummaryResult:null}},componentDidMount:function(){this.getOptions()},hourlySummaryNeedsCanvasRender:!1,errorSummaryNeedsCanvasRender:!1,componentDidUpdate:function(){this.hourlySummaryNeedsCanvasRender&&(this.paintChart_HourlySummary(),this.hourlySummaryNeedsCanvasRender=!1);this.errorSummaryNeedsCanvasRender&&(this.paintChart_ErrorSummary(),this.errorSummaryNeedsCanvasRender=!1)},render:function(){var n=this.state.options,r=this.state.hourlySummaryResult,u=this.state.errorSummaryResult,t;if(n===null)return null;var f=this.getProducts(n).map(function(n){return React.createElement("option",{value:n},n)}),e=this.getEnvironments(n,this.state.criteria_product).map(function(n){return React.createElement("option",{value:n},n)}),o=this.getVersions(n,this.state.criteria_product,this.state.criteria_environment).map(function(n){return React.createElement("option",{value:n},n)}),s=this.state.fromOptions.map(function(n){return React.createElement("option",{value:n.value},n.label)}),h=this.state.toOptions.map(function(n){return React.createElement("option",{value:n.value},n.label)}),i=null;return r&&(i=React.createElement("div",null,React.createElement("h3",{id:"headingHourly"},"Hourly Summary"),React.createElement("hr",null),React.createElement("div",{id:"myLineChartContainer"},React.createElement("canvas",{id:"myLineChart",width:"970",height:"400"})),React.createElement("div",{id:"myLineChartLegend"}))),t=null,u&&(t=React.createElement("div",{id:"errorSummarySection"},React.createElement("h3",null,"Error Summary"),React.createElement("hr",null),React.createElement("div",{id:"myPieChartContainer"},React.createElement("canvas",{id:"myPieChart",width:"600",height:"300"})),React.createElement("div",{id:"myPieChartLegend"}),React.createElement(DataTable,{sortBy:"latestOccurrence",sortAsc:!1,data:this.state.errorSummaryResult.details,columnDefinitions:[{field:"errorType",display:"Type",onCellClick:this.openErrorHistory},{field:"errorDescription",display:"Description"},{field:"objectName",display:"Object",onCellClick:this.openErrorHistory},{field:"subName",display:"Sub",onCellClick:this.openErrorHistory},{field:"timesOccurred",display:"# Errors"},{field:"latestOccurrence",display:"Latest"},{field:"usersAffected",display:"Users Affected"}]}))),React.createElement("div",{className:"row"},React.createElement("div",{id:"criteria",className:"expanded"},React.createElement("form",{className:"form-horizontal",role:"form"},React.createElement("div",{className:"form-group"},React.createElement("label",{"for":"selectProduct",className:"col-sm-4 control-label"},"Product"),React.createElement("div",{className:"col-sm-8"},React.createElement("select",{id:"selectProduct",className:"form-control",value:this.state.criteria_product,onChange:this.handleCriteriaChange},f))),React.createElement("div",{className:"form-group"},React.createElement("label",{"for":"selectEnvironment",className:"col-sm-4 control-label"},"Environment"),React.createElement("div",{className:"col-sm-8"},React.createElement("select",{id:"selectEnvironment",className:"form-control",value:this.state.criteria_environment,onChange:this.handleCriteriaChange},e))),React.createElement("div",{className:"form-group"},React.createElement("label",{"for":"selectVersion",className:"col-sm-4 control-label"},"Version"),React.createElement("div",{className:"col-sm-8"},React.createElement("select",{id:"selectVersion",className:"form-control",value:this.state.criteria_version,onChange:this.handleCriteriaChange},o))),React.createElement("div",{className:"form-group"},React.createElement("label",{"for":"selectFrom",className:"col-sm-4 control-label"},"From"),React.createElement("div",{className:"col-sm-8"},React.createElement("select",{id:"selectFrom",className:"form-control",value:this.state.criteria_from,onChange:this.handleCriteriaChange},s))),React.createElement("div",{className:"form-group"},React.createElement("label",{"for":"selectTo",className:"col-sm-4 control-label"},"To"),React.createElement("div",{className:"col-sm-8"},React.createElement("select",{id:"selectTo",className:"form-control",value:this.state.criteria_to,onChange:this.handleCriteriaChange},h))))),React.createElement("div",{id:"view",className:"with-criteria"},i,t),React.createElement(ErrorHistoryModal,{ref:"errorHistoryModal"}))},selectedProductChanged:function(){app.getHourlySummary();app.refreshOptions("Product")},openErrorHistory:function(n,t){n==="errorType"?this.popupErrorDetails(t.errorType,"",""):n==="objectName"?this.popupErrorDetails("",t.objectName,""):this.popupErrorDetails("",t.objectName,t.subName)},handleCriteriaChange:function(n){var t={errorSummaryResult:null},i=!1;n.target.id==="selectProduct"?(i=!0,t.criteria_product=n.target.value,t.criteria_environment=this.getEnvironments(this.state.options,t.criteria_product)[0],t.criteria_version=this.getVersions(this.state.options,t.criteria_product,t.criteria_environment)[0]):n.target.id==="selectEnvironment"?(i=!0,t.criteria_environment=n.target.value,t.criteria_version=this.getVersions(this.state.options,this.state.criteria_product,t.criteria_environment)[0]):n.target.id==="selectVersion"?(i=!0,t.criteria_version=n.target.value):n.target.id==="selectFrom"?(t.criteria_from=parseInt(n.target.value),t.criteria_from>=this.state.criteria_to&&(t.criteria_to=t.criteria_from+1)):n.target.id==="selectTo"&&(t.criteria_to=parseInt(n.target.value),t.criteria_to<=this.state.criteria_from&&(t.criteria_from=t.criteria_to-1));i?this.getHourlySummary(t.criteria_product||this.state.criteria_product,t.criteria_environment||this.state.criteria_environment,t.criteria_version||this.state.criteria_version):this.hourlySummaryNeedsCanvasRender=!0;this.setState(t)},getHourlySummary:function(n,t,i){$.ajax({context:this,type:"GET",headers:{Authorization:"Bearer "+app.getAccessToken()},url:app.HTTP+"://"+app.HOST_NAME+"/api/hourlysummary?product="+encodeURIComponent(n)+"&environment="+encodeURIComponent(t)+"&version="+encodeURIComponent(i)+"&date="}).done(function(n){var f,t;this.hourlySummaryNeedsCanvasRender=!0;var i=[],r=[],e=null,u=null;if(n.timesOccurred.length>0)for(f=0,n.timesOccurred.length>36&&(f=n.timesOccurred.length-36),t=0;t<n.timesOccurred.length;t++)t===f&&(e={value:t,label:n.timesOccurred[t].key}),t===0?i.push({value:t,label:n.timesOccurred[t].key}):t===n.timesOccurred.length-1?(u={value:t,label:n.timesOccurred[t].key},r.push(u)):(i.push({value:t,label:n.timesOccurred[t].key}),r.push({value:t,label:n.timesOccurred[t].key}));this.setState({hourlySummaryResult:n,fromOptions:i,toOptions:r,criteria_from:e.value,criteria_to:u.value})}).fail(function(n,t){toastr.error(n.responseText||t,"System Error")})},paintChart_HourlySummary:function(){for(var o,i,r=[],u=[],f=[],e=[],n=this.state.hourlySummaryResult,t=parseInt(this.state.criteria_from);t<=parseInt(this.state.criteria_to);t++)r.push(n.timesOccurred[t].key),u.push(n.timesOccurred[t].value),f.push(n.procsAffected[t].value),e.push(n.usersAffected[t].value);n={labels:r,datasets:[{label:"Total errors",fillColor:"rgba(200,200,200,0.2)",strokeColor:"rgba(200,200,200,1)",pointColor:"rgba(200,200,200,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(200,200,200,1)",data:u},{label:"Procedures affected",fillColor:"rgba(151,205,187,0.2)",strokeColor:"rgba(151,205,187,1)",pointColor:"rgba(151,205,187,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,205,187,1)",data:f},{label:"Users affected",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:e}]};$("#myLineChart").remove();$("#myLineChartContainer").append('<canvas id="myLineChart" height="400" width="979"><canvas>');o=$("#myLineChart").get(0).getContext("2d");i=new Chart(o).Line(n,{scaleFontColor:"rgb(100,100,100)",scaleLineColor:"rgba(60,60,60,0.4)",scaleShowGridLines:!0,scaleGridLineColor:"rgba(80,80,80,.1)",scaleGridLineWidth:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend">'+"<% for (var i=0; i<datasets.length; i++){%>"+'<li><span class="badge" style="margin-right: 5px; background-color:<%=datasets[i].strokeColor%>">•<\/span><%if(datasets[i].label){%><%=datasets[i].label%><%}%>'+"<\/li>"+"<%}%>"+"<\/ul>"});this.myLineChart=i;$("#myLineChart").click(this.handleLineChartLabelClick);$("#myLineChartLegend").empty();$("#myLineChartLegend").append(i.generateLegend())},getErrorSummary:function(n,t,i,r,u){$.ajax({context:this,type:"GET",headers:{Authorization:"Bearer "+app.getAccessToken()},url:app.HTTP+"://"+app.HOST_NAME+"/api/errorsummary?product="+encodeURIComponent(n)+"&environment="+encodeURIComponent(t)+"&version="+encodeURIComponent(i)+"&date="+r+"&hour="+u+"&objectName="}).done(function(n){this.errorSummaryNeedsCanvasRender=!0;this.setState({errorSummaryResult:n})})},paintChart_ErrorSummary:function(){for(var u,f,t,n=this.state.errorSummaryResult,r=[],e=["rgb(247, 70, 74)","rgb(70, 191, 189)","rgb(253, 180, 92)","rgb(121,157,205)","rgb(135, 76, 194)"],o=["rgba(247, 70, 74, 0.7)","rgba(70, 191, 189, 0.7)","rgba(253, 180, 92, 0.7)","rgba(121,157,205,0.7)","rgba(135, 76, 194,0.7)"],i=0;i<n.timesOccurred.length;i++)r.length>4?(r[4].value=r[4].value+n.timesOccurred[i].value,r[4].label=r[4].label+", "+n.timesOccurred[i].key):r.push({value:n.timesOccurred[i].value,color:e[i],highlight:o[i],label:n.timesOccurred[i].key});for($("#myPieChart").remove(),$("#myPieChartContainer").append('<canvas id="myPieChart" height="300" width="800"><canvas>'),u=$("#myPieChart").get(0).getContext("2d"),f=new Chart(u).Pie(r,{segmentShowStroke:!0,segmentStrokeColor:"rgb(70,70,70)",segmentStrokeWidth:2,legendTemplate:'<table style="width: 370px" class="<%=name.toLowerCase()%>-legend">'+"<tbody>"+"<% for (var i=0; i<segments.length; i++){%>"+'<tr><td><span class="badge" style="background-color:<%=segments[i].fillColor%>"><%=segments[i].value%><\/span><\/td><td style="padding-left: 5px;"><%if(segments[i].label){%><%=segments[i].label%><%}%><\/td>'+"<\/tr>"+"<%}%>"+"<\/tbody><\/table>"}),$("#myPieChartLegend").empty(),$("#myPieChartLegend").append(f.generateLegend()),$("#errorSummaryTableBody").empty(),t=0;t<n.details.length;t++)$("#errorSummaryTableBody").append('<tr><td class="text-right"><a href="javascript:;" onclick="app.popUpErrorHistory(\''+n.details[t].errorType+"',null,null)\">"+n.details[t].errorType+"<\/a><\/td><td>"+n.details[t].errorDescription+'<\/td><td><a href="javascript:;" onclick="app.popUpErrorHistory(null,\''+n.details[t].objectName+"',null)\">"+n.details[t].objectName+'<\/a><\/td><td><a href="javascript:;" onclick="app.popUpErrorHistory(null,\''+n.details[t].objectName+"','"+n.details[t].subName+"')\">"+n.details[t].subName+'<\/td><td class="text-center">'+n.details[t].timesOccurred+'<\/td><td class="text-right">'+n.details[t].latestOccurrence+'<\/td><td class="text-center">'+n.details[t].usersAffected+"<\/td><\/tr>")},getOptions:function(){$.ajax({context:this,type:"GET",headers:{Authorization:"Bearer "+app.getAccessToken()},url:app.HTTP+"://"+app.HOST_NAME+"/api/options"}).done(function(n){var t=null,i=null,r=null;if(n&&n.length>0){var t=this.getProducts(n)[0],i=this.getEnvironments(n,t)[0],r=this.getVersions(n,t,i)[0];this.getHourlySummary(t,i,r)}this.setState({options:n,criteria_product:t,criteria_environment:i,criteria_version:r})})},getProducts:function(n){for(var i=[],t=0;t<n.length;t++)i.indexOf(n[t].product)===-1&&i.push(n[t].product);return i},getEnvironments:function(n,t){for(var r=[],i=0;i<n.length;i++)n[i].product===t&&r.indexOf(n[i].environment)===-1&&r.push(n[i].environment);return r},getVersions:function(n,t,i){for(var u=[],r=0;r<n.length;r++)n[r].product===t&&n[r].environment===i&&u.indexOf(n[r].version)===-1&&u.push(n[r].version);return u},handleLineChartLabelClick:function(n){var t=this.myLineChart.getPointsAtEvent(n);t.length!==0&&(this.lastDateClicked=t[0].label.split(" ")[0].replace("/","-").replace("/","-"),this.lastHourClicked=t[0].label.split(" ")[1],this.getErrorSummary(this.state.criteria_product,this.state.criteria_environment,this.state.criteria_version,this.lastDateClicked,this.lastHourClicked))},popupErrorDetails:function(n,t,i){$.ajax({context:this,type:"GET",headers:{Authorization:"Bearer "+app.getAccessToken()},url:app.HTTP+"://"+app.HOST_NAME+"/api/errorhistory?environment="+encodeURIComponent(this.state.criteria_environment)+"&version=&errorType="+n+"&objectName="+t+"&subName="+i+"&userId="}).done(function(n){this.refs.errorHistoryModal.open(n)})},pollNeedsRefresh:function(){$.ajax({type:"GET",headers:{Authorization:"Bearer "+app.getAccessToken()},url:app.HTTP+"://"+app.HOST_NAME+"/api/needsrefresh?product="+encodeURIComponent(this.state.criteria_product)+"&environment="+encodeURIComponent(this.state.criteria_environment)+"&version="+encodeURIComponent(this.state.criteria_version)+"&date="+this.state.hourlySummaryResult.latestPoll}).done(function(n){n&&this.getHourlySummary(this.state.criteria_product,this.state.criteria_environment,this.state.criteria_version,!0)})}});
//# sourceMappingURL=app.min.js.map
